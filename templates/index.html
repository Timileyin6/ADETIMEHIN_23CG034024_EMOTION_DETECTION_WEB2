<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Emotion Detection Web App</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <h1>Emotion Detector (lightweight)</h1>
    <p>Upload an image or capture from your camera.</p>

    <form id="uploadForm">
      <input type="text" name="name" placeholder="Your name (optional)" />
      <input type="email" name="email" placeholder="Email (optional)" />
      <input type="file" name="file" accept="image/*" />
      <button type="submit">Upload & Analyze</button>
    </form>

    <hr />

    <div>
      <h3>Live capture</h3>
      <video id="video" autoplay playsinline width="320" height="240"></video>
      <br />
      <button id="snap">Capture & Analyze</button>
    </div>

    <hr />
    <div id="result">Result will appear here</div>

    <hr />
    <div>
      <button id="listRecords">Show recent records (console)</button>
    </div>
  </div>

<script>
const uploadForm = document.getElementById("uploadForm");
uploadForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const fd = new FormData(uploadForm);
  const res = await fetch("/analyze", {method:"POST", body: fd});
  const j = await res.json();
  document.getElementById("result").innerText = JSON.stringify(j, null, 2);
});

const video = document.getElementById("video");
navigator.mediaDevices && navigator.mediaDevices.getUserMedia({video:true})
  .then(stream => { video.srcObject = stream; })
  .catch(e => { console.log("No camera or permission denied", e); });

document.getElementById("snap").addEventListener("click", async () => {
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth || 320;
  canvas.height = video.videoHeight || 240;
  canvas.getContext("2d").drawImage(video, 0, 0);
  const dataUrl = canvas.toDataURL("image/jpeg");
  const name = prompt("Your name (optional)") || "anonymous";
  const email = "";
  const fd = new FormData();
  fd.append("name", name);
  fd.append("email", email);
  fd.append("imageBase64", dataUrl);
  const res = await fetch("/analyze", {method:"POST", body: fd});
  const j = await res.json();
  document.getElementById("result").innerText = JSON.stringify(j, null, 2);
});

document.getElementById("listRecords").addEventListener("click", async () => {
  const res = await fetch("/records");
  const recs = await res.json();
  console.log("Recent records:", recs);
  alert("Check browser console for records (or call /records endpoint).");
});
</script>
</body>
</html>
